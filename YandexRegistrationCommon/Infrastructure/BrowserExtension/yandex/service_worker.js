!function(){"use strict";const t=new class{constructor(){this.data_=null}initialize(t){this.data_=t}get(t){if(!this.data_)throw new Error("Configuration is not initialized!");if(!Object.hasOwnProperty.call(this.data_,t))throw new Error(`Invalid configuration key! ${t}`);return this.data_[t]}};const e=new class{constructor(){this.data_=chrome.runtime.getManifest()}getVersion(t="."){return this.data_.version.split(".").join(t)}};var a,s,n;!function(t){t.CHROME="chrome",t.CHROMIUM="chromium",t.EDGE="edge",t.OPERA="opera",t.YABROWSER="yabrowser"}(a||(a={})),function(t){t.CHROME="Google Chrome",t.CHROMIUM="Chromium",t.EDGE="Microsoft Edge",t.OPERA="Opera",t.YANDEX="Yandex"}(s||(s={})),function(t){t.MAC="darwin",t.WINDOWS="winnt"}(n||(n={}));const r=new class{constructor(){this.userAgentBrands_=this.getUserAgentBrands_()}getUserAgentBrands_(){const t=new Set;if(navigator.userAgentData)for(const{brand:e}of navigator.userAgentData.brands)t.add(e);else{const{userAgent:e}=navigator;/YaBrowser/.test(e)&&t.add(s.YANDEX),/OPR\//.test(e)&&t.add(s.OPERA),/Edg\//.test(e)&&t.add(s.EDGE),/Chrome/.test(e)&&!/MRCHROME|Comodo/.test(e)&&t.add(s.CHROME),/Chromium/.test(e)&&t.add(s.CHROMIUM)}return t}getUserAgent(){return this.userAgentBrands_.has(s.YANDEX)?a.YABROWSER:this.userAgentBrands_.has(s.OPERA)?a.OPERA:this.userAgentBrands_.has(s.EDGE)?a.EDGE:this.userAgentBrands_.has(s.CHROME)?a.CHROME:this.userAgentBrands_.has(s.CHROMIUM)?a.CHROMIUM:null}getOS(){const t=navigator.userAgentData?navigator.userAgentData.platform:window.navigator.platform,e=t.toLocaleLowerCase();return e.startsWith("win")?n.WINDOWS:e.startsWith("mac")?n.MAC:t}};var i,o;!function(t){t.CLIENT="690.2354",t.EXTERNAL="690.2854",t.SCRIPT="690.2609",t.UNCAUGHT="690.2361"}(i||(i={})),function(t){t.CRITICAL="critical",t.DEBUG="debug",t.ERROR="error",t.INFO="info",t.TRACE="trace",t.WARN="warn"}(o||(o={}));const c=new class{async uncaught(t,e={}){const a=this.getVars_(t,o.CRITICAL,e);await fetch(this.getUrl_(i.UNCAUGHT,a)).catch((()=>this.fallbackError_())).catch(console.error)}async error(t,e={}){const a=this.getVars_(t,o.ERROR,e);await fetch(this.getUrl_(i.CLIENT,a)).catch((()=>this.fallbackError_())).catch(console.error)}async info(t,e={}){const a=this.getVars_(t,o.INFO,e);await fetch(this.getUrl_(i.CLIENT,a)).catch((()=>this.fallbackError_())).catch(console.error)}async fallbackError_(){await fetch(this.getUrl_(i.CLIENT,"-project=homesearch,-msg=ebfallback"))}getUrl_(t,e){return new URL(`/clck/click/path=${t}/vars=${e}/*`,"https://yandex.ru").toString()}getVars_(a,s,n={}){const i={msg:a,level:s,project:t.get("errorboosterProject"),service:t.get("yasoft"),timestamp:Date.now(),version:e.getVersion(),useragent:r.getUserAgent(),additional:this.prepareAdditional_(n)};return Object.keys(i).filter((t=>i[t])).map((t=>`-${t}=${encodeURIComponent(this.toWellFormed(i[t]))}`)).join(",")}prepareAdditional_(t){return 0===Object.keys(t).length?"":JSON.stringify(t)}toWellFormed(t){return t.toWellFormed?t.toWellFormed():t}};class l{constructor(t){this.response_=t,this.ok=this.response_.ok}async text(){return this.response_.text()}}class d{constructor(t){this.url_=new URL(t)}async run(){const t=await fetch(this.url_.toString()).catch((t=>new Response(t.message,{status:418})));return t.ok||c.error("Fetch Error",{body:await t.text(),status:t.status,url:this.url_.toString()}),new l(t)}}const h=new class{constructor(t){this.baseParams_=t}async send(t){const e=Object.assign(Object.assign({},this.baseParams_),t),a=this.buildUrl_(e);(await new d(a).run()).ok?console.log("Clicker statistics sent:",a):console.log("Clicker statistics error:",a)}buildUrl_(e){const a=e.path||["platform","feature","version","action"].map((t=>e[t])).filter(Boolean).join(".");return t.get("clickerUrl").replace("{pid}",encodeURIComponent(e.pid)).replace("{cid}",encodeURIComponent(e.cid)).replace("{path}",encodeURIComponent(a)).replace("{vars}","")}}({pid:12,cid:72359,platform:r.getUserAgent(),version:e.getVersion().split(".").join("-")});const u=new class{run(){chrome.action.onClicked.addListener((()=>{const e=new URL(t.get("portalUrl"));console.log("Opening portal",e.toString()),chrome.tabs.create({url:e.toString()}),h.send({pid:12,cid:72975,platform:null,feature:t.get("yasoft"),action:"icon"})}))}};var g;!function(t){t.APPLICATION_UID="application.ui",t.BANNER_ID="application.banner.id",t.EXPERIMENTS="application.experiments",t.INSTALL_DATE="application.installDate",t.IS_YANDEX_UI="yandex.statistics.is-yandex-ui",t.NTP_COOKIE_SET_TIME="ntp.cookie.set.time",t.PRESET_DATE="yandex.statistics.presetDate",t.SOFT_EXPORT_TIME="yandex.statistics.time",t.STATISTICS_UID="yandex.statistics.ui",t.TIME="yandex.statistics.time",t.UPDATE_DATE="application.updateDate",t.VERSION="application.version",t.YANDEX_STATISTICS_UID="yandex.statistics.yandexUi",t.YANDEX_STATISTICS_EXIST_UI="yandex.statistics.exist.ui",t.CLID_1="yandex.statistics.clid.1",t.CLID_5="yandex.statistics.clid.5",t.CLID_6="yandex.statistics.clid.6",t.CLID_7="yandex.statistics.clid.7",t.CLID_8="yandex.statistics.clid.8",t.CLID_9="yandex.statistics.clid.9",t.CLID_11="yandex.statistics.clid.11",t.CLID_12="yandex.statistics.clid.12",t.CLID_14="yandex.statistics.clid.14",t.CLID_15="yandex.statistics.clid.15",t.CLID_17="yandex.statistics.clid.17",t.CLID_18="yandex.statistics.clid.18",t.CLID_20="yandex.statistics.clid.20",t.CLID_21="yandex.statistics.clid.21",t.CLID_23="yandex.statistics.clid.23",t.CLID_28="yandex.statistics.clid.28",t.CLID_29="yandex.statistics.clid.29",t.CLID_30="yandex.statistics.clid.30"}(g||(g={}));class m{constructor(){this.promise=new Promise(((t,e)=>{this.resolve_=t,this.reject_=e}))}resolve(){this.resolve_()}reject(){this.reject_()}}const _=new class{constructor(){this.initializeDeferred_=new m}async tryInitialize(t){const e=await chrome.storage.local.get(t);e&&e[t]&&this.initializeDeferred_.resolve()}async get(t,e=!0){e&&await this.initializeDeferred_.promise;const a=await chrome.storage.local.get(t);return a&&a[t]}async set(t,e){return chrome.storage.local.set({[t]:e})}async setDate(t,e){let a=e.getTime();switch(t){case g.INSTALL_DATE:case g.UPDATE_DATE:case g.SOFT_EXPORT_TIME:a/=1e3}await this.set(t,String(a))}async setDateIfEmpty(t,e){await this.get(t,!1)||await this.setDate(t,e)}async getDate(t){let e=await this.get(t);if("string"==typeof e&&(e=Number.parseFloat(e)),"number"==typeof e&&!isNaN(e))switch(t){case g.INSTALL_DATE:case g.UPDATE_DATE:case g.SOFT_EXPORT_TIME:return new Date(1e3*e);default:return new Date(e)}}};class p{constructor(){this.tab_=null,this.initPromise_=this.initTab_()}async initTab_(){const t=await chrome.tabs.query({});this.tab_=this.findTab_(t)}async getParams(){return await this.initPromise_,this.tab_?new URL(this.tab_.url).searchParams:null}}const y=new class extends p{findTab_(t){var e;return null!==(e=t.find((t=>t.url&&t.url.startsWith("https://chromewebstore.google.com/detail/")&&t.url.indexOf(chrome.runtime.id)>0)))&&void 0!==e?e:null}},w="banerid";const I=new class{async readFromWebstoreTab(){const t=await y.getParams();if(t&&t.has(w)){const e=t.get(w);return await _.set(g.BANNER_ID,e),e}return null}async getValue(){let t=await _.get(g.BANNER_ID);return t||(t||(t=await this.readFromWebstoreTab()),null!=t?t:null)}};const D=new class{async get(e){if(!g[`CLID_${e}`])return"";const a=await _.get(g[`CLID_${e}`]),s=t.get(`clid${e}`);return a&&"none"!==a?a:s||""}},f=(t=new Date,e=3)=>{const a=t.getHours()<e?t.getDate()-1:t.getDate();return new Date(t.getFullYear(),t.getMonth(),a,e)},x=t=>{const e=f(t);return Math.floor((Date.now()-e.getTime())/864e5)},E="http://chrome-elements.yandex.addons/";const T=new class{async get(t){const e={url:E,name:t},a=await chrome.cookies.get(e);return(null==a?void 0:a.value)?this.getValue_(a.value):void 0}set(t,e){const a={url:E,name:t,value:this.processValue_(e),expirationDate:Math.floor((Date.now()+15768e7)/1e3)};chrome.cookies.set(a)}processValue_(t){return"object"==typeof t?encodeURIComponent(JSON.stringify(t)):"string"==typeof t?encodeURIComponent(t):String(t)}getValue_(t){let e=decodeURIComponent(t);try{e=JSON.parse(e)}catch(t){}return e}},S="yandex.statistics.ui";const A=new class{async getValue(){const t=await T.get(S);let e=await _.get(g.YANDEX_STATISTICS_UID)||await _.get(g.APPLICATION_UID)||await _.get(g.YANDEX_STATISTICS_EXIST_UI)||await _.get(g.STATISTICS_UID);e&&e.startsWith("%7B")&&(e=decodeURIComponent(e));let a="string"==typeof t?t:e;return/^{[0-9A-F-]+}$/.test(a)||(a=""),a||(a=this.generateValue_()),a&&"string"!=typeof t&&T.set(S,a),a&&!e&&await _.set(g.APPLICATION_UID,a),a}generateValue_(){return"{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}".split("").map((t=>"x"!==t?t:"0123456789ABCDEF"[Math.floor(16*Math.random())])).join("")}};const C=new class{run(){chrome.runtime.onInstalled.addListener((()=>{this.setGoodbyePage_()}))}async setGoodbyePage_(){const a={yasoft:t.get("yasoftChr"),ui:await A.getValue(),gchid:chrome.runtime.id,bnrd:await I.getValue(),ver:e.getVersion(),os:r.getOS(),stat:"uninstall",brandID:t.get("brandId"),clid:await D.get(1),dateinstall:(s=await _.getDate(g.INSTALL_DATE),`${String(s.getDate()).padStart(2,"0")}.${String(s.getMonth()+1).padStart(2,"0")}.${s.getFullYear()}`)};var s;const n=new URL(t.get("goodbyeUrl"));for(const t in a)a[t]&&n.searchParams.set(t,a[t]);const i=["bnrd","gchid","brandID","ver","os"];for(;n.toString().length>255&&i.length;)n.searchParams.delete(i.pop());try{await chrome.runtime.setUninstallURL(n.toString()),console.log("Set uninstall URL",n.toString())}catch(t){console.error("Failed to set goodby URL:",n.toString(),t.message)}}};const U=new class{run(){chrome.runtime.onInstalled.addListener((async t=>{"install"===t.reason&&await I.readFromWebstoreTab(),"update"===t.reason&&await _.setDate(g.UPDATE_DATE,new Date),await _.setDateIfEmpty(g.INSTALL_DATE,new Date),this.initStorage_()})),this.initStorage_()}initStorage_(){_.tryInitialize(g.INSTALL_DATE)}},b=["https://yandex.{tld}/chrome/newtab/","https://www.yandex.{tld}/chrome/newtab/"],L=["ru","ua","by","kz","com.tr"],R=36e5,O="ntp_cookie_alarm";const N=new class{run(){chrome.runtime.onInstalled.addListener((()=>{this.updateCookies_()})),chrome.alarms.onAlarm.addListener((t=>{t.name===O&&this.updateCookies_()}))}scheduleNextUpdate_(){chrome.alarms.create(O,{delayInMinutes:Math.floor(60)})}async updateCookies_(){const t="ext-"+chrome.runtime.id,e=JSON.stringify({id:await _.get(g.INSTALL_DATE),ud:await _.get(g.UPDATE_DATE),t:Date.now(),d:{clid:await D.get(6),from:"chromesearch"}});for(const a of b)for(const s of L)await chrome.cookies.set({url:a.replace("{tld}",s),name:t,value:e,expirationDate:Math.floor((Date.now()+R)/1e3),sameSite:"no_restriction",secure:!0});await _.setDate(g.NTP_COOKIE_SET_TIME,new Date),this.scheduleNextUpdate_()}};const v=new class{async send(){const e=t.get("dayuseStatUrl").replace("{vars}",await this.getVars_()).replace("{slots}",await this.getSlots_());new d(e).run(),console.log("Day use statistics sent:",e)}async getVars_(){const a=await _.getDate(g.INSTALL_DATE),s={dayuse:String(x(a)),bro:r.getUserAgent(),productname:t.get("yasoft"),ver:e.getVersion().split(".").join("-"),ui:await A.getValue(),brandID:t.get("brandId"),clid1:await D.get(1),bnrd:await I.getValue(),gchid:chrome.runtime.id};return Object.keys(s).filter((t=>s[t])).map((t=>`-${t}=${encodeURIComponent(s[t])}`)).join(",")}async getSlots_(){const t=await _.get(g.EXPERIMENTS);let e=[0,0,0];if(Array.isArray(t)){const a=t[0];a&&(e=[a.testId,a.testId,a.bucket])}return e.map(encodeURIComponent).join(",")}};var P;!function(t){t.INSTALL="install",t.DAY_USE="dayuse"}(P||(P={}));const k=new class{async send(a){var s={yasoft:t.get("yasoftChr"),ui:await A.getValue(),ver:e.getVersion(),os:r.getUserAgent(),stat:a,brandID:t.get("brandId"),clid:await D.get(1),bnrd:await I.getValue(),gchid:chrome.runtime.id};const n=new URL(t.get("softExportUrl"));for(const t in s)Object.hasOwnProperty.call(s,t)&&s[t]&&n.searchParams.set(t,s[t]);await new d(n.toString()).run(),console.log("Soft export statistics sent:",n.toString())}},M="statistics_alarm";const j=new class{run(){chrome.runtime.onInstalled.addListener((t=>{this.scheduleDailyUsageSend_(1),c.info(t.reason)})),chrome.alarms.onAlarm.addListener((async t=>{t.name===M&&this.sendDailyUsageStats_()}))}async scheduleDailyUsageSend_(t){await chrome.alarms.clear(M),chrome.alarms.create(M,{delayInMinutes:t})}async sendDailyUsageStats_(){this.scheduleDailyUsageSend_(15);const t=await _.getDate(g.SOFT_EXPORT_TIME);this.checkCanSend(t)&&(await _.setDate(g.SOFT_EXPORT_TIME,new Date),await k.send(t?P.DAY_USE:P.INSTALL),await v.send())}checkCanSend(t){return!t||(!(t instanceof Date)||(!!isNaN(t.getTime())||f().getTime()>t.getTime()))}};const V=new class extends p{findTab_(e){var a;const s=t.get("tld"),n=`https://yandex.${s}/promo/set/`,r=`https://yandex.${s}/promo/set/welcome`;return null!==(a=e.find((t=>t.url&&t.url.startsWith(n)&&!t.url.startsWith(r))))&&void 0!==a?a:null}};const W=new class{async run(){chrome.runtime.onInstalled.addListener((t=>{"install"===t.reason&&this.openWelcome_()}))}async openWelcome_(){const e=new URL(t.get("welcomeUrl"));await this.addTabParams_(e,y,"w"),await this.addTabParams_(e,V,"l"),e.searchParams.set("gchid",chrome.runtime.id),console.log("Opening welcome",e.toString()),chrome.tabs.create({url:e.toString()}),h.send({pid:12,cid:72975,platform:null,feature:t.get("yasoft"),action:"welcome-open"})}async addTabParams_(t,e,a){const s=await e.getParams();if(!s)return void t.searchParams.set(a,"-1");let n=0;for(const[e,a]of s)t.searchParams.has(e)||(t.searchParams.set(e,a),n+=1);t.searchParams.set(a,String(n))}};function Y(t){try{return decodeURIComponent(t)}catch(e){return t}}var F=function(t){if(!t||"string"!=typeof t||!t.length)return{};/%23\d{10}/.test(t)&&(t=Y(t)),t=t.split("#");for(var e,a=Date.now()/1e3,s={},n=0,r=t.length;n<r;n++)2===(e=t[n].split(".")).length?s[e[0]]=Y(e[1]):e.length>2&&(isNaN(e[0])?s[e[0]]=Y(e.slice(1).join(".")):e[0]>a&&(s[e[1]]={value:Y(e.slice(2).join(".")),expires:new Date(+(e[0]+"000"))}));return s},B=function(t){if(t&&"object"==typeof t){for(var e,a,s=[],n=0,r=Object.keys(t),i=r.length;n<i;n++)e=t[r[n]],a=[r[n],encodeURIComponent(e.value||e)],/\d+/.test(e.expires)&&a.unshift(e.expires),s.push(a.join("."));return s.join("#")}};const X=["https://yandex.ru/","https://yandex.kz/","https://yandex.ua/","https://yandex.by/","https://yandex.uz/","https://yandex.net/","https://yandex.com/","https://yandex.com.tr/","https://ya.ru/"],$="ys_cookie_alarm";const H=[U,W,C,u,N,j,new class{run(){chrome.runtime.onInstalled.addListener((()=>{this.updateYSCookies_()})),chrome.alarms.onAlarm.addListener((t=>{t.name===$&&this.updateYSCookies_()}))}scheduleNextYSCookieUpdate_(){chrome.alarms.create($,{delayInMinutes:60})}async updateYSCookies_(){const a=await A.getValue();for(const s of X){const n=await chrome.cookies.get({name:"ys",url:s}),r=n?F(n.value):{};r[t.get("yasoft")]=e.getVersion("-");const i=new Set((r.gchid?r.gchid:"").split(";").filter(Boolean).concat(chrome.runtime.id));r.gchid=Array.from(i).join(";"),r.ui=a,await chrome.cookies.set({url:s,name:"ys",value:B(r),sameSite:"no_restriction",secure:!0}),console.log("YS cookie is set for",s,r)}this.scheduleNextYSCookieUpdate_()}}];t.initialize({brandId:"yandex",tld:"ru",clid1:"2189880",clid6:"2196598",yasoft:"searchextchrome",yasoftChr:"searchextchrome_chr",clickerUrl:"https://yandex.ru/clck/click/dtype=stred/pid={pid}/cid={cid}/path={path}{vars}/*",dayuseStatUrl:"https://yandex.ru/clck/click/dtype=elduse/path=tech.yaelements.dayuse/vars={vars}/slots={slots}/*",softExportUrl:"https://soft.export.yandex.ru/status.xml",portalUrl:"https://ya.ru/?clid=2196598",welcomeUrl:"https://browser.yandex.ru/tools/redirect/ext_p?app=search",goodbyeUrl:"https://yandex.ru/soft/extensions/goodbye",errorboosterProject:"homesearch"}),self.addEventListener("error",(t=>{c.uncaught(t.message)})),self.addEventListener("unhandledrejection",(t=>{c.uncaught(t.reason)}));for(const t of H)t.run()}();
